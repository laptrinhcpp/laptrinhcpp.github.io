<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="../../../css/reset.css">
    <title>3.6 Fixed-width integer và size_t</title>
    <link rel="stylesheet" href="../../../css/substyle.css">
    <link rel="shortcut icon" href="../../../img/circle-logo.ico">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="../../../js/showhide.js"></script>
</head>

<body> 
    <div class="title">
        <h1>3.6 Fixed-width integer và size_t</h1>
    </div>

    <div class="content">
        
        <p>Ở các bài học trước, các bạn đã biết về kích thước tối thiểu của các kiểu dữ liệu integer và kích thước thật có thể lớn hơn tùy vào mỗi máy, compiler.</p>
        <p>Vì sao kích thước của các biến integer lại không cố định trên tất cả các thiết bị?</p>
        <p>Câu trả lời cho câu hỏi trên bắt nguồn từ ngôn ngữ tiền thân của C++, đó là C. Vào thời trước, lúc C được sinh ra, máy tính lúc đó rất chậm và hiệu suất chương trình là thứ được quan tâm nhiều nhất. Và vì mỗi máy đều có hệ thống vận hành khác nhau nên C không thể áp dụng kích thước cố định cho tất cả thiết bị được. Thay vào đó, C chỉ đưa ra số liệu tối thiểu và nhường quyền quyết định kích thước của các integer cho nhà phát triển phần mềm và máy tính để đạt được hiệu suất tốt nhất đối trên thiết bị của họ. Nó giống như người ta đưa cho bạn một lượng nguyên vật liệu nhất định bảo bạn xây một cái nhà. Bạn có thể chỉ dùng đống nguyên vật liệu đó hoặc mua thêm nguyên vật liệu để xây nhà. Họ không quan tâm bạn làm như thế nào, miễn sao bạn xây được một căn nhà tốt nhất mà thôi.</p>
        <p>Đối với một lập trình viên, điều trên khá là bất lợi. Ví dụ bạn viết một chương trình trên một compiler có kích thước của kiểu int là 4 byte, và nó chạy rất tốt. Thế nhưng nếu chạy nó trên compiler có kích thước kiểu int là 2 byte thì chương trình sẽ có vấn đề vì bị mất dữ liệu.</p>
        <h3 class="muc">Fixed-width integer</h3>
        <p>Để tăng khả năng cross-platform của chương trình (cross-platform là khả năng sử dụng được trên nhiều thiết bị khác nhau), C99 có định nghĩa một số fixed-width integer (trong header file stdint.h). Fixed-width integer là kiểu dữ liệu có kích thước cố định trên mọi compiler. Dưới đây là một số fixed-width integer.</p>
        <table border=1 cellspacing=0 cellpadding=5>
            <tr>
                <th>Kiểu</th>
                <th>Kích thước</th>
                <th>Phạm vi</th>
                <th>Ghi chú</th>
            </tr>
            <tr>
                <td>std::int8_t</td>
                <td>1 byte signed</td>
                <td>-128 đến 127</td>
                <td>Đóng vai trò như signed char ở một số hệ thống. Xem phần ở dưới</td>
            </tr>
            <tr>
                <td>std::uint8_t</td>
                <td>1 byte unsigned</td>
                <td>0 đến 255</td>
                <td>Đóng vai trò như unsigned char ở một số hệ thống. Xem phần ở dưới</td>
            </tr>
            <tr>
                <td>std::int16_t</td>
                <td>2 byte signed</td>
                <td>-32,768 đến 32,767</td>
                <td></td>
            </tr>
            <tr>
                <td>std::uint16_t</td>
                <td>2 byte unsigned</td>
                <td>0 đến 65,535</td>
                <td></td>
            </tr>
            <tr>
                <td>std::int32_t</td>
                <td>4 byte signed</td>
                <td>-2,147,483,648 đến 2,147,483,647</td>
                <td></td>
            </tr>
            <tr>
                <td>std::uint32_t</td>
                <td>4 byte unsigned</td>
                <td>0 đến 4,294,967,295</td>
                <td></td>
            </tr>
            <tr>
                <td>std::int64_t</td>
                <td>8 byte signed</td>
                <td>-9,223,372,036,854,775,808 đến 9,223,372,036,854,775,807</td>
                <td></td>
            </tr>
            <tr>
                <td>std::uint64_t</td>
                <td>8 byte unsigned</td>
                <td>0 đến 18,446,744,073,709,551,615</td>
                <td></td>
            </tr>
        </table>
        <p>Những thứ trên được tạo ra từ C, tuy nhiên C++ cũng được thừa hưởng chúng kể từ C++11 trở lên. Bạn có thể sử dụng chúng bằng cách include header file <i>cstdint</i>, những thứ trên đều nằm trong std namespace nên bạn cần thêm std:: ở đằng trước.</p>
        <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border-radius:10px;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7
8
9</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #0000ff">#include &lt;iostream&gt;</span>
<span style="color: #0000ff">#include &lt;cstdint&gt;</span>
 
<span style="color: #2b91af">int</span> main()
{
    std::<span style="color: #2b91af">int16_t</span> i{5}; <span style="color: #008000">// khởi tạo đồng nhất</span>
    std::cout &lt;&lt; i;
    <span style="color: #0000ff">return</span> 0;
}
</pre></td></tr></table></div>

        <p>Fixed-width integer có hai nhược điểm. Thứ nhất, đôi khi nó sẽ không được hỗ trợ trên một số compiler. Thứ hai, nó có thể ảnh hưởng đến hiệu suất chương trình như mình đã giải thích ở đầu bài. Do đó, bạn nên tránh sử dụng chúng.</p>
        <h3 class="muc">Fast và least integer</h3>
        <p>Ngoài các kiểu integer trên, C++ còn bổ sung thêm hai loại integer nữa.</p>
        <p>std::int_fast#_t cung cấp một integer nhanh nhất mà có kích thước ít nhất là # bit (# có thể là 8, 16, 32 hoặc 64). Ví dụ std::int_fast16_t sẽ cung cấp một integer nhanh nhất có kích thước tối thiểu là 16 bit, nó có thể hơn 16 bit. Nhanh nhất ở đây có nghĩa là integer đó cho hiệu suất chương trình tốt nhất.</p>
        <p>std::int_least#_t cung cấp một integer nhỏ nhất và có kích thước tối thiểu là # bit (# có thể là 8, 16, 32 hoặc 64). Ví dụ std::int_least16_t sẽ cung cấp một integer nhỏ nhất và có kích thước tối thiểu là 16 bit, nó có thể hơn 16 bit.</p>
        <p>Đọc hai định nghĩa trên bạn thấy bối rối đúng không? Mới đọc thì thấy vậy thôi chứ đọc kỹ lại thì đúng là bối rối thật 😜 Mình sẽ giải thích rõ hơn về hai loại này và khi nào nên dùng nhé.</p>
        <p>Khi bạn dùng fast integer, compiler sẽ cung cấp một integer mà nó tin rằng integer đó sẽ giúp chương trình chạy tốt nhất. Chẳng hạn như ví dụ trên, std::int_fast16_t sẽ cấp một integer có thể có kích thước là 16 bit, có thể là 32 hoặc thậm chí là 64 bit nhưng ít nhất phải là 16 bit nhé, miễn sao compiler nghĩ rằng integer đó giúp tăng hiệu suất chương trình. Và cũng vì vậy, std::int_fast#_t dùng khi bạn muốn chương trình đạt hiệu suất tốt nhất và bạn không quan tâm đến vấn đề bộ nhớ do nó có thể tốn rất nhiều bộ nhớ.</p>
        <p>Khi bạn dùng least integer, compiler sẽ cung cấp một integer khả dụng mà có kích thước nhỏ nhất nhưng phải lớn hơn kích thước # bit. Mình giả sử compiler của bạn có hỗ trợ integer có kích thước 8 bit, 15 bit, 17 bit, 32 bit (cái này là ví dụ nhé chứ không có máy hỗ trợ 15 hay 17 bit đâu). Bạn dùng std::int_least16_t, bạn thấy là 16 bit không nằm trong kích thước được hỗ trợ. Do đó, compiler sẽ lấy integer nhỏ nhất mà có kích thước lớn hơn 16 bit, đó là 17 bit. Ưu điểm của loại này là nó giúp tiết kiệm bộ nhớ rất tốt, nhưng bù lại hiệu suất chương trình không được như fast integer.</p>
        <p>Xét chương trình sau để kiểm tra kích thước của fast và least integer.</p>
        <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border-radius:10px;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #0000ff">#include &lt;iostream&gt;</span>
<span style="color: #0000ff">#include &lt;cstdint&gt;</span>
 
<span style="color: #2b91af">int</span> main()
{
    std::cout &lt;&lt; <span style="color: #a31515">&quot;fast 8: &quot;</span> &lt;&lt; <span style="color:    #0000ff">sizeof</span>(std::<span style="color: #2b91af">int_fast8_t</span>) * 8 &lt;&lt; <span style="color:   #a31515">&quot; bits\n&quot;</span>;    <span style="color: #008000">// nhân 8 vì toán tử sizeof trả về dạng byte  nhé</span>
    std::cout &lt;&lt; <span style="color: #a31515">&quot;fast 16: &quot;</span> &lt;&lt; <span style="color:   #0000ff">sizeof</span>(std::<span style="color: #2b91af">int_fast16_t</span>) * 8 &lt;&lt; <span style="color: #a31515">&quot; bits\n&quot;</span>;
    std::cout &lt;&lt; <span style="color: #a31515">&quot;fast 32: &quot;</span> &lt;&lt; <span style="color:   #0000ff">sizeof</span>(std::<span style="color: #2b91af">int_fast32_t</span>) * 8 &lt;&lt; <span style="color: #a31515">&quot; bits\n&quot;</span>;
    
    std::cout &lt;&lt; <span style="color: #a31515">&quot;least 8: &quot;</span> &lt;&lt; <span style="color:   #0000ff">sizeof</span>(std::<span style="color: #2b91af">int_least8_t</span>) * 8 &lt;&lt; <span style="color: #a31515">&quot; bits\n&quot;</span>;
    std::cout &lt;&lt; <span style="color: #a31515">&quot;least 16: &quot;</span> &lt;&lt; <span style="color:  #0000ff">sizeof</span>(std::<span style="color: #2b91af">int_least16_t</span>) * 8 &lt;&lt; <span style="color:   #a31515">&quot; bits\n&quot;</span>;
    std::cout &lt;&lt; <span style="color: #a31515">&quot;least 32: &quot;</span> &lt;&lt; <span style="color:  #0000ff">sizeof</span>(std::<span style="color: #2b91af">int_least32_t</span>) * 8 &lt;&lt; <span style="color:   #a31515">&quot; bits\n&quot;</span>;
    
    <span style="color: #0000ff">return</span> 0;
}
</pre></td></tr></table></div>

        <p>Đối với máy của mình (máy 64 bit) dùng Visual Studio thì cho ra output sau:</p>
        <div class="codeblock"><pre><code>fast 8: 8 bits
fast 16: 64 bits
fast 32: 64 bits
least 8: 8 bits
least 16: 16 bits
least 32: 32 bits</code></pre></div>

        <p>Bạn có thể thấy ở ví dụ std::int_fast16_t và std::int_fast32_t nó đều in ra 64 bit vì máy của mình thuộc loại 64 bit và nó nghĩ rằng 64 bit là kích thước tối ưu nhất về mặt hiệu suất.</p>
        <p>Nếu máy bạn thuộc loại 32 bit, kết quả có thể như sau:</p>
        <div class="codeblock"><pre><code>fast 8: 8 bits
fast 16: 32 bits
fast 32: 32 bits
least 8: 8 bits
least 16: 16 bits
least 32: 32 bits</code></pre></div>
        <p></p>
        <p>Ngoài ra hai kiểu trên còn có kiểu unsigned tương ứng là std::uint_fast#_t và std::uint_least#_t.</p>
        <h3 class="muc">std::int8_t và std::uint8_t có thể biểu diễn char thay vì integer</h3>
        <p>Note: Chúng ta sẽ nói rõ hơn về kiểu char ở bài sau.</p>
        <p>Phần lớn compiler định nghĩa và xem std::int8_t và std::uint8_t như signed và unsigned char. Char tức là kiểu dữ liệu dành cho text. Để thấy rõ điều này, ta dùng ví dụ sau:</p>
        <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border-radius:10px;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #0000ff">#include &lt;cstdint&gt;</span>
<span style="color: #0000ff">#include &lt;iostream&gt;</span>
 
<span style="color: #2b91af">int</span> main()
{
    std::<span style="color: #2b91af">int8_t</span> myint = 65;
    std::cout &lt;&lt; myint;
 
    <span style="color: #0000ff">return</span> 0;
}
</pre></td></tr></table></div>

        <p>Một số máy sẽ in ra 65 như suy nghĩ của bạn. Tuy nhiên trên thực tế, phần lớn sẽ in ra chữ 'A' thay vì 65. Đó là do compiler xem std::int8_t là char mà không phải integer. Lý do vì sao nó in ra 'A' mà không phải chữ khác hay mối quan hệ giữa integer và char mình sẽ nói rõ hơn khi bạn học đến char. Hiện tượng trên cũng xảy ra tương tự với fast và least integer có kích thước 8 bit.</p>
        <p class="luu-y">Lưu ý: Nên tránh sử dụng đến fixed-width integer có kích thước 8 bit vì compiler có thể xem nó là kiểu char và sẽ xảy ra kết quả không mong muốn. </p>
        <h3 class="muc">Cách dùng các kiểu integer hợp lý</h3>
        <p>Khi bạn làm việc với integer, bạn nên làm những điều sau:</p>
        <ul>
            <li>Nên dùng <i>int</i> khi bạn không quan tâm đến kích thước của integer (tất nhiên giá trị lưu phải nằm trong phạm vi của 2 byte signed integer). Ví dụ bạn cần người dùng nhập tuổi của họ hoặc đếm từ 1 đến 100 thì bạn có thể dùng <i>int</i>, cho dù trên máy 32 bit hay 64 bit thì cũng không ảnh hưởng đến chương trình.</li>
            <li>Khi bạn muốn tối ưu hiệu suất chương trình thì dùng std::int_fast#_t.</li>
            <li>Khi bạn muốn tối ưu bộ nhớ thì dùng std::int_least#_t.</li>
        </ul>
        <p>Còn những điều sau đây nên tránh nếu có thể:</p>
        <ul>
            <li>Unsigned integer, trừ khi bạn chắn chắc việc sử dụng nó sẽ không gây ra vấn đề gì nằm ngoài tầm kiểm soát.</li>
            <li>Fixed-width integer có kích thước 8 bit.</li>
        </ul>
        <h3 class="muc">Size_t là gì?</h3>
        <p>Xét code sau:</p>
        <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border-radius:10px;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7
8</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #0000ff">#include &lt;iostream&gt;</span>
 
<span style="color: #2b91af">int</span> main()
{
    std::cout &lt;&lt; <span style="color: #0000ff">sizeof</span>(<span style="color: #2b91af">int</span>);
 
    <span style="color: #0000ff">return</span> 0;
}
</pre></td></tr></table></div>

        <p>Trên máy của mình, nó in ra:</p>
        <div class="codeblock"><pre><code>4</code></pre></div>
        <p>Theo bạn, con số 4 in ra ở trên nó thuộc kiểu integer nào? Kiểu int hay short?</p>
        <p>Câu trả lời là giá trị trả về của toán tử sizeof (hay bất kì hàm nào liên quan đến kích thước, độ dài) thuộc kiểu dữ liệu <i>size_t</i>. <b>size_t</b> là một kiểu dữ liệu dạng unsigned integer, dùng để biểu thị kích thước và độ dài của một đối tượng.</p>
        <p>Kích thước của kiểu size_t tùy thuộc vào máy của bạn. Thử dùng toán tử sizeof xem kích thước của nó trên máy bạn là bao nhiêu nhé.</p>
        <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border-radius:10px;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7
8</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #0000ff">#include &lt;iostream&gt;</span>

<span style="color: #2b91af">int</span> main()
{
	std::cout &lt;&lt; <span style="color: #0000ff">sizeof</span>(<span style="color: #2b91af">size_t</span>);
 
	<span style="color: #0000ff">return</span> 0;
}
</pre></td></tr></table></div>

        <p>Đối với máy 64 bit (8 byte) của mình, nó in ra:</p>
        <div class="codeblock"><pre><code>8</code></pre></div>
        <p>Đối với máy 32 bit (4 byte), nó sẽ in ra:</p>
        <div class="codeblock"><pre><code>4</code></pre></div>
        <p>Vì size_t là unsigned integer nên nó không thể chứa số âm. Điều này là hiển nhiên vì không có kích thước hay độ dài nào là âm cả. Kích thước của size_t sẽ quyết định kích thước đối tượng lớn nhất mà bạn có thể tạo ra, kích thước đó bằng số lớn nhất mà size_t có thể chứa (đơn vị là byte). Ví dụ, nếu máy bạn là 32 bit (4 byte) thì số lớn nhất mà size_t có thể chứa là 4,294,967,295. Như vậy, đối tượng trên máy của bạn có kích thước tối đa là 4,294,967,295 byte. Đối với máy 64 bit, kích thước đó sẽ bằng bình phương của con số kia. Nếu bạn tạo một đối tượng có kích thước lớn hơn kích thước tối đa thì sẽ xảy ra lỗi biên dịch, chương trình sẽ không biên dịch được.</p>

        <div>
            <a href="#"><button class="btn">Bài tiếp theo</button></a>
        </div>
        <div>
            <a href="../../index.html"><button class="btn">C++ Index</button></a>
        </div>
        <div>
            <a href="../3-5-unsigned-integer-va-vi-sao-nen-tranh-dung/index.html"><button class="btn">Bài trước</button></a>
        </div>

    </div>
</body>

</html>